!function(t,e){"use strict";"function"==typeof define&&define.amd?define("path",function(){return t.Path=e(),t.Path}):t.Path=e()}(this,function(){"use strict";var t={version:"0.9.1",map:function(e){return t.routes.defined.hasOwnProperty(e)?t.routes.defined[e]:new t.core.route(e)},root:function(e){t.routes.root=e},rescue:function(e){t.routes.rescue=e},history:{initial:{},pushState:function(e,i,o){t.history.supported?t.dispatch(o)&&history.pushState(e,i,o):t.history.fallback&&(window.location.hash="#"+o)},popState:function(){var e=!t.history.initial.popped&&location.href===t.history.initial.URL;t.history.initial.popped=!0,e||t.dispatch(document.location.pathname)},listen:function(e){if(t.history.supported=!(!window.history||!window.history.pushState),t.history.fallback=e,t.history.supported)t.history.initial.popped="state"in window.history?!0:!1,t.history.initial.URL=location.href,window.onpopstate=t.history.popState;else if(t.history.fallback){for(var i in t.routes.defined)"#"!==i.charAt(0)&&(t.routes.defined["#"+i]=t.routes.defined[i],t.routes.defined["#"+i].path="#"+i);t.listen()}}},match:function(e,i){var o,n,r,s,u,h={},a=null;for(a in t.routes.defined)if(null!==a&&void 0!==a)for(a=t.routes.defined[a],o=a.partition(),s=0;s<o.length;s+=1){if(n=o[s],u=e,n.search(/:/)>0)for(r=0;r<n.split("/").length;r+=1)r<u.split("/").length&&":"===n.split("/")[r].charAt(0)&&(h[n.split("/")[r].replace(/:/,"")]=u.split("/")[r],u=u.replace(u.split("/")[r],n.split("/")[r]));if(n===u)return i&&(a.params=h),a}return null},dispatch:function(e){var i,o;if(t.routes.current!==e){if(t.routes.previous=t.routes.current,t.routes.current=e,o=t.match(e,!0),t.routes.previous&&(i=t.match(t.routes.previous),null!==i&&null!==i.do_exit&&i.do_exit()),null!==o)return o.run(),!0;null!==t.routes.rescue&&t.routes.rescue()}},listen:function(){var e=function(){t.dispatch(location.hash)};""===location.hash&&null!==t.routes.root&&(location.hash=t.routes.root),"onhashchange"in window&&(!document.documentMode||document.documentMode>=8)?window.onhashchange=e:setInterval(e,50),""!==location.hash&&t.dispatch(location.hash)},core:{route:function(e){this.path=e,this.action=null,this.do_enter=[],this.do_exit=null,this.params={},t.routes.defined[e]=this}},routes:{current:null,root:null,rescue:null,previous:null,defined:{}}};return t.core.route.prototype={to:function(t){return this.action=t,this},enter:function(t){return t instanceof Array?this.do_enter=this.do_enter.concat(t):this.do_enter.push(t),this},exit:function(t){return this.do_exit=t,this},partition:function(){for(var t,e,i=[],o=[],n=/\(([^}]+?)\)/g;t=n.exec(this.path);)i.push(t[1]);for(o.push(this.path.split("(")[0]),e=0;e<i.length;e+=1)o.push(o[o.length-1]+i[e]);return o},run:function(){var e,i,o=!1;if(t.routes.defined[this.path].hasOwnProperty("do_enter")&&t.routes.defined[this.path].do_enter.length>0)for(e=0;e<t.routes.defined[this.path].do_enter.length;e+=1)if(i=t.routes.defined[this.path].do_enter[e].apply(this,null),i===!1){o=!0;break}o||t.routes.defined[this.path].action()}},t});